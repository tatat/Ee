(function(e){e([],function(){"use strict";var e=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){var n=e.length,r=Number(t)||0;r=r<0?Math.ceil(r):Math.floor(r),r<0&&(r+=n);for(;r<n;r++)if(r in e&&e[r]===t)return r;return-1},t=Array.prototype.forEach?function(e,t,n){e.forEach(t,n)}:function(e,t,n){for(var r=0,i=e.length;r<i;r++)r in e&&t.call(n,e[r],r,e)},n=Array.prototype.slice,r=typeof process!="undefined"&&typeof process.nextTick=="function"?function(e){process.nextTick(e)}:function(e){setTimeout(e,0)},i=Array.isArray?function(e){return Array.isArray(e)}:function(e){return Object.prototype.toString.call(e)==="[object Array]"},s=function(){},o=function(e,t){e&&typeof e!="function"&&(t=e,e=null),this.__events={},this.__emitted={},this.__until={},this.__listeners=null,t=t||{},this.new_listener=!!t.new_listener,t.data_store&&o.DataStore.call(this),!e&&t.Event&&(e=t.Event);if(e&&e.prototype instanceof o.Event)this.Event=e;else if(!this.Event||!(this.Event.prototype instanceof o.Event))this.Event=o.Event};o.prototype.reserve=function(e){i(e)||(e=[e]);var t=this.__events;for(var n=0,r=e.length;n<r;n++)t.hasOwnProperty(e[n])||(t[e[n]]=[]),t[e[n]].reserved=!0;return this},o.prototype.unreserve=function(e){i(e)||(e=[e]);var t=this.__events;for(var n=0,r=e.length;n<r;n++)t.hasOwnProperty(e[n])&&(t[e[n]].length?delete t[e[n]].reserved:delete t[e[n]]);return this},o.prototype.lookup=function(e,n,r){typeof e=="function"&&(r=n,n=e,e=null);var i=this.__events,s=[];e instanceof RegExp||(e==null&&(e=""),e=new RegExp(e));for(var o in i)i.hasOwnProperty(o)&&e.test(o)&&s.push(o);return n?(t(s,n,this),r?this:s):s},o.prototype.on=function(e,t,n,r,s){i(e)||(e=[e]),i(t)||(t=[t]),n=n==null?-1:n-0||0;var o=this.__events,u=this.new_listener,a=r?"unshift":"push",f=t.length,l,c,h,p=[];for(var d=0,v=e.length,m;d<v;d++){l=e[d],o[l]||(o[l]=[]);for(m=0;m<f;m++)c=t[m],h={type:l,listener:c,times:n},o[l][a](h),p.push(h),u&&this.emit("newListener",l,c,n,r)}if(s!=null){i(s)||(s=[s]);var g=this.__until,y;for(d=0,v=s.length;d<v;d++)y=s[d],g[y]||(g[y]=[]),g[y].push.apply(g[y],p)}return this.__listeners=p,this},o.prototype.once=function(e,t,n,r){return this.on(e,t,1,n,r)},o.prototype.first=function(e,t,n,r){return this.on(e,t,n,!0,r)},o.prototype.until=function(e,t,n,r,i){return this.on(t,n,r,i,e)},o.prototype.within=function(e,t,n,r,i,s,o){if(typeof e=="object"&&e){var u=e;e=u.within,t=u.event||u.events,n=u.listener||u.listeners,r=u.callback,i=u.times,s=u.first,o=u.until}var a=this,f=this.on(t,n,i,s,o).__listeners;return setTimeout(function(){a.off(t,f),r&&r.call(a,f)},e-0||0),this},o.prototype.off=function(t,n){var r,s;if(i(t)){for(r=0,s=t.length;r<s;r++)this.off(t[r],n);return this}if(i(n)){for(r=0,s=n.length;r<s;r++)this.off(t,n[r]);return this}var o=this.__events,u=this.__emitted,a;if(!o[t])return this;if(n==null)return o[t].reserved?o[t].length=0:delete o[t],this;if(typeof n=="function"){a=-1;for(var f=o[t],r=0,s=f.length;r<s;r++)if(f[r].listener===n){a=r;break}}else a=e(o[t],n);return a!==-1&&(o[t].splice(a,1),o[t].length===0&&!o[t].reserved&&delete o[t]),this},o.prototype.size=function(e){return this.listeners(e,!0).length},o.prototype.ever=function(e){if(e==null){var t=this.__emitted,n=0;for(var r in t)t[r]!=null&&(n+=t[r]);return n}return this.__emitted[e]||0},o.prototype.listeners=function(e,t){var n=this.__events,r,i,s,o;if(e==null){r=[];for(i in n)for(s=0,o=n[i].length;s<o;s++)r.push(n[i][s])}else r=(n[e]||[]).slice();if(!t)for(s=0,o=r.length;s<o;s++)r[s]=r[s].listener;return r},o.prototype.trigger=function(e,t,n){var r,i=this.__events,s=this.__emitted,u=this.__until,a;this.__listeners=null,e instanceof o.Event?(r=e,e=r.type):r=new this.Event(e),s[e]==null&&(s[e]=0),s[e]++;if(u[e]){for(var f=u[e],l=0,c=f.length;l<c;l++)this.off(f[l].type,f[l]);delete u[e]}if(!i[e]){if(e==="error")throw t[0]?t[0]instanceof Error?t[0]:new Error(t[0]):new Error("Uncaught, unspecified 'error' event.");a=[]}else a=i[e].slice();return t.unshift(r),n.call(this,e,r,a,t),this},o.prototype.emit=function(e){return this.trigger(e,n.call(arguments,1),function(e,t,n,r){t.abortable=!0;for(var i,s=0,o=n.length;s<o&&!t.aborted;s++)t.position=s,i=n[s],i.times!==-1&&--i.times===0&&this.off(e,i),i.listener.apply(this,r)})};var u=function(e,t,n,r,i,s){r.times!==-1&&--r.times===0&&e.off(t,r),s?s.length>3?s.call(e,r,n,i,function(){r.listener.apply(e,i)}):(s.call(e,r,n,i),r.listener.apply(e,i)):r.listener.apply(e,i)};return o.prototype.chain=function(e,t,n,r){return typeof t=="function"&&(r=n,n=t,t=[]),this.trigger(e,t||[],function(e,t,i,s){var o=this,a;t.abortable=!0,t.preventable=!0,t.position=-1;if(i.length===0)return n&&n.call(o,t);(function f(){if(t.aborted||t.prevented||!(a=i.shift()))return n&&n.call(o,t);t.position++,t.__next=f,u(o,e,t,a,s,r)}).call(t)})},o.prototype.parallel=function(e,n,i,s){return typeof n=="function"&&(s=i,i=n,n=[]),this.trigger(e,n||[],function(e,n,o,a){var f=this;n.__complete=function(){i&&i.call(f,n)},n.undone=o.length;if(o.length===0)return r(n.__complete);t(o,function(t){r(function(){u(f,e,n,t,a,s)})})})},o.prototype.Event=null,o.DataStore=function(){this.get=function(e,t){return this.data?this.data.hasOwnProperty(e)?this.data[e]:t:t},this.set=function(e,t){return this.data||(this.data={}),this.data[e]=t,this},this.unset=function(e){return this.data&&delete this.data[e],this}},o.Event=function(e){this.type=e,this.abortable=!1,this.aborted=!1,this.prevented=!1,this.preventable=!1,this.position=null,this.undone=null,this.__next=null,this.__complete=null},o.Event.prototype=new o.DataStore,o.Event.prototype.stop=function(){return this.abortable&&(this.aborted=!0),this.preventable&&(this.prevented=!0),this.abortable||this.prevented?this.next():this},o.Event.prototype.abort=function(){return this.abortable&&(this.aborted=!0,this.next()),this},o.Event.prototype.prevent=function(){return this.preventable&&(this.prevented=!0,this.next()),this},o.Event.prototype.next=function(){if(this.__next){var e=this.__next;this.__next=null,e.call(this)}return this},o.Event.prototype.done=function(){if(this.__complete&&--this.undone<=0){var e=this.__complete;this.__complete=null,e.call(this)}return this},o})})(typeof define!="undefined"?define:typeof module!="undefined"?function(e,t){module.exports=t()}:function(e,t){this.Ee=t()});